(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{395:function(t,e,n){var content=n(426);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(12).default)("57ca24e7",content,!0,{sourceMap:!1})},396:function(t,e,n){var content=n(428);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(12).default)("76843692",content,!0,{sourceMap:!1})},397:function(t,e,n){var content=n(430);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(12).default)("2821628c",content,!0,{sourceMap:!1})},425:function(t,e,n){"use strict";n(395)},426:function(t,e,n){var r=n(11)(!1);r.push([t.i,"div[data-v-4d8ebf48]{display:inline}",""]),t.exports=r},427:function(t,e,n){"use strict";n(396)},428:function(t,e,n){var r=n(11)(!1);r.push([t.i,".disciplines-table[data-v-773429da]{margin-bottom:16px}.disciplines-table th[data-v-773429da]{background-color:#f5f5f5;color:#000!important;font-size:16px;height:56px;text-align:left;padding:6px}td[data-v-773429da]{padding:8px;line-height:1.6}td[data-v-773429da]:not(:last-child),th[data-v-773429da]:not(:last-child){border-right:1px solid #dcdcdc}.table-small-font[data-v-773429da]{font-size:12px;line-height:1.2}.v-tex-field__details[data-v-773429da]{display:none!important}.internet-no .v-btn[data-v-773429da]{color:#727272;background-color:#ddd!important}.request-actions[data-v-773429da]{display:inline-block}.request-actions .v-select[data-v-773429da]{display:inline-block;width:142px}.arrows[data-v-773429da]{display:inline-block;float:right;visibility:hidden;color:#ccc}.th-sort[data-v-773429da]:hover{cursor:pointer}th:hover>.arrows[data-v-773429da]{cursor:pointer;visibility:visible}.up[data-v-773429da]{bottom:6px;left:20px}.down[data-v-773429da],.up[data-v-773429da]{position:relative}.down[data-v-773429da]{bottom:-10px}.active[data-v-773429da]{visibility:visible;color:#727272}.request-buttons .v-btn[data-v-773429da]{font-size:12px!important}",""]),t.exports=r},429:function(t,e,n){"use strict";n(397)},430:function(t,e,n){var r=n(11)(!1);r.push([t.i,".request-actions .v-input__control .v-input__slot fieldset{border-color:#006179}.request-actions .v-select__slot .v-icon,.request-actions .v-select__slot label{color:#006179}#request-list .v-file-input{display:none}@media print{#footer,#header,#hide-request{display:none}.arrows,.hide-action-col{display:none!important}}.tooltip{opacity:1!important;background:#00152b!important;max-width:400px;line-height:1.5!important;cursor:pointer}",""]),t.exports=r},497:function(t,e,n){"use strict";n.r(e);n(7),n(6),n(8),n(9),n(10);var r=n(17),o=n(1),c=(n(61),n(27)),l=(n(43),n(393)),d=n.n(l),v=n(194),f=n(394),h=n.n(f),m={name:"JsonCSV",props:{data:{type:Array,required:!0},fields:{required:!1},delimiter:{type:String,default:",",required:!1},separatorExcel:{type:Boolean,default:!1},encoding:{type:String,default:"utf-8"},advancedOptions:{type:Object,default:function(){}},labels:{required:!1},testing:{required:!1,default:!1}},computed:{idName:function(){return"export_"+(new Date).getTime()},exportableData:function(){var t=this.cleaningData();return t.length?t:null}},methods:{labelsFunctionGenerator:function(){var t=this;if(!d.a.isUndefined(this.labels)&&!d.a.isFunction(this.labels)&&!d.a.isObject(this.labels))throw new Error("Labels needs to be a function(value,key) or object.");return d.a.isFunction(this.labels)?function(e){return d.a.mapKeys(e,t.labels)}:d.a.isObject(this.labels)?function(e){return d.a.mapKeys(e,(function(e,n){return t.labels[n]||n}))}:function(t){return t}},fieldsFunctionGenerator:function(){var t=this;if(!(d.a.isUndefined(this.fields)||d.a.isFunction(this.fields)||d.a.isObject(this.fields)||d.a.isArray(this.fields)))throw new Error("Fields needs to be a function(value,key) or array.");return d.a.isFunction(this.fields)||d.a.isObject(this.fields)&&!d.a.isArray(this.fields)?function(e){return d.a.pickBy(e,t.fields)}:d.a.isArray(this.fields)?function(e){return d.a.pick(e,t.fields)}:function(t){return t}},cleaningData:function(){if(d.a.isUndefined(this.fields)&&d.a.isUndefined(this.labels))return this.data;var t=this.labelsFunctionGenerator(),e=this.fieldsFunctionGenerator();return d.a.map(this.data,(function(n){return t(e(n))}))},generate:function(){this.$emit("export-started");var t=this.exportableData;if(t){var e=h.a.unparse(t,Object.assign({delimiter:this.delimiter,encoding:this.encoding},this.advancedOptions));if(this.separatorExcel&&(e="SEP="+this.delimiter+"\r\n"+e),"utf-8"===this.encoding&&(e="\ufeff"+e),this.$emit("export-finished"),!this.testing){var n=new Blob([e],{type:"application/csv;charset="+this.encoding}),r=new Date,o=r.getMonth()+1+"-"+r.getDate()+"-"+r.getFullYear()+" requests.csv";Object(v.saveAs)(n,o)}}else console.error("No data to export")}}},w=(n(425),n(40)),x=Object(w.a)(m,(function(){var t=this,e=t.$createElement;return(t._self._c||e)("div",{attrs:{id:"csv"},on:{click:t.generate}},[t._t("default",[t._v("\n    Download data\n  ")])],2)}),[],!1,null,"4d8ebf48",null).exports;function y(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,n)}return e}function S(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?y(Object(source),!0).forEach((function(e){Object(o.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):y(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var k={name:"requests",middleware:"authenticated",computed:S(S({},Object(c.c)(["admin"])),{},{sortedRequests:function(){var t=this;return this.requests?this.requests.sort((function(a,b){var e=1;return"asc"===t.currentSortDir&&(e=-1),a[t.currentSort]<b[t.currentSort]?-1*e:a[t.currentSort]>b[t.currentSort]?1*e:0})):null},online:function(){return!!navigator&&navigator.onLine}}),components:{JsonCSV:x},data:function(){return{requests:[],requestsForExport:[],items:["Pending","Completed"],statusIsPending:!0,currentSort:"dateRequested",currentSortDir:"asc",chosenFile:null,jstor:"https://www.jstor.org/stable/"}},mounted:function(){this.getRequests(!1)},methods:{getRequests:function(t){var e=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var r,o,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t&&(e.statusIsPending=!e.statusIsPending),r={pending:e.statusIsPending},n.next=4,e.$axios.$get("/admin/request",{params:r});case 4:for(o=n.sent,console.log("studentRequests in requests: ",o),e.requests=o.data.requests,e.requestsForExport=_.cloneDeep(o.data.requests),c=0;c<e.requestsForExport.length;c++)delete e.requestsForExport[c].pdf,0===e.requestsForExport[c].status&&(e.requestsForExport[c].status="printed"),1===e.requestsForExport[c].status&&(e.requestsForExport[c].status="saved as PDF"),2===e.requestsForExport[c].status&&(e.requestsForExport[c].status="pending review"),3===e.requestsForExport[c].status&&(e.requestsForExport[c].status="denied"),e.requestsForExport[c].url='=HYPERLINK("'+e.jstor+e.requestsForExport[c].id+'")';case 9:case"end":return n.stop()}}),n)})))()},update:function(t,article){var e=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var r,o,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r={requestID:article.requestID,articleID:article.id,status:t},0!==t){n.next=13;break}if(!e.online){n.next=6;break}open("https://www.jstor.org/stable/pdf/"+article.id+".pdf"),n.next=11;break;case 6:return n.next=8,e.$axios.get("/admin/pdf/"+article.id,{responseType:"blob"});case 8:o=n.sent,console.log(o),e.showPDF(o.data,article.id);case 11:n.next=22;break;case 13:if(1!==t){n.next=22;break}if(!e.online){n.next=18;break}open("https://www.jstor.org/stable/pdf/"+article.id+".pdf"),n.next=22;break;case 18:return n.next=20,e.$axios.get("/admin/pdf/"+article.id);case 20:c=n.sent,e.savePDF(c.data.content,article.id);case 22:return n.prev=22,n.next=25,e.$axios.$patch("/admin/request",r);case 25:n.sent,n.next=31;break;case 28:n.prev=28,n.t0=n.catch(22),console.log("logging the error: ",n.t0.response.data);case 31:e.getRequests(!1);case 32:case"end":return n.stop()}}),n,null,[[22,28]])})))()},savePDF:function(t,e){var a=document.createElement("a");a.style.display="none",document.body.appendChild(a),a.href=window.URL.createObjectURL(t),a.setAttribute("download",e+".pdf"),a.click(),window.URL.revokeObjectURL(a.href),document.body.removeChild(a)},showPDF:function(t,e){var n=window.URL.createObjectURL(t);window.open(n).print()},formatStatus:function(t){return 0===t?"Printed":1===t?"Downloaded":3===t?"Denied":"Unknown"},formatCitation:function(cite){return cite.indexOf("</cite>")>-1?"from "+(cite=cite.substring(6)).substring(0,cite.indexOf("</cite>"))+cite.substring(cite.indexOf("</cite>")+7):cite},print:function(){window.print()},sort:function(s){s===this.currentSort&&(this.currentSortDir="asc"===this.currentSortDir?"desc":"asc"),this.currentSort=s},uploadFile:function(){document.getElementById("fileUpload").click()},importCSV:function(){var t=this,e=[];if(this.chosenFile){var n=new FileReader;n.readAsText(this.chosenFile),n.onload=function(){e=h.a.parse(n.result,{header:!0,dynamicTyping:!0}),console.log("json.data ",e.data);var r=[];for(var o in e.data)r.push(e.data[o]);for(var i=0;i<t.requests.length;i++){for(var c=!1,l=0;l<r.length;l++)if(r[l].id==t.requests[i].id&&r[l].studentName==t.requests[i].studentName&&r[l].dateRequested===t.requests[i].dateRequested){c=!0;break}c||r.push(t.requests[i])}t.requests=r}}},JSTORurl:function(t){return"https://www.jstor.org/stable/"+t}}},D=(n(427),n(429),n(60)),F=n.n(D),O=n(361),j=n(370),P=n(490),R=n(371),C=n(496),E=n(423),T=n(491),I=Object(w.a)(k,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.admin?n("div",{attrs:{id:"request-list"}},[n("v-row",[n("v-col",{attrs:{cols:"5"}},[n("h1",[t._v("View Student Requests")])]),t._v(" "),n("v-col",{staticClass:"request-actions",attrs:{cols:"7",id:"hide-request"}},[n("v-btn",{attrs:{outlined:"",height:"40px",color:"primary"},on:{click:function(e){return t.uploadFile()}}},[t._v("Import list (.csv)\n      ")]),t._v(" "),n("v-file-input",{attrs:{accept:".csv",id:"fileUpload"},on:{change:t.importCSV},model:{value:t.chosenFile,callback:function(e){t.chosenFile=e},expression:"chosenFile"}}),t._v(" "),n("json-c-s-v",{attrs:{data:t.requestsForExport}},[n("v-btn",{attrs:{outlined:"",height:"40px",color:"primary"}},[t._v("Export list (.csv)\n        ")])],1),t._v(" "),n("v-btn",{attrs:{outlined:"",height:"40px",color:"primary"},on:{click:function(e){return t.print()}}},[t._v("Print this list\n      ")]),t._v(" "),n("v-select",{attrs:{outlined:"",dense:"",id:"selectRequests",color:"primary",value:"Pending",items:t.items},on:{change:function(e){return t.getRequests(!0)}}})],1)],1),t._v(" "),n("v-simple-table",{staticClass:"disciplines-table"},[n("thead",[n("tr",[n("th",{staticClass:"th-sort",staticStyle:{width:"30%"},on:{click:function(e){return t.sort("title")}}},[t._v("\n        Title\n        "),n("span",{staticClass:"arrows"},[n("span",{staticClass:"up",class:{active:"title"===this.currentSort&&"asc"===this.currentSortDir}},[t._v("▲")]),t._v(" "),n("span",{staticClass:"down",class:{active:"title"===this.currentSort&&"desc"===this.currentSortDir}},[t._v("▼")])])]),t._v(" "),n("th",{staticClass:"th-sort",staticStyle:{width:"14%"},on:{click:function(e){return t.sort("studentName")}}},[t._v("\n        Name\n        "),n("span",{staticClass:"arrows"},[n("span",{staticClass:"up",class:{active:"studentName"===this.currentSort&&"asc"===this.currentSortDir}},[t._v("▲")]),t._v(" "),n("span",{staticClass:"down",class:{active:"studentName"===this.currentSort&&"desc"===this.currentSortDir}},[t._v("▼")])])]),t._v(" "),n("th",{staticClass:"th-sort",staticStyle:{width:"12%"},on:{click:function(e){return t.sort("dateRequested")}}},[t._v("\n        Requested\n        "),n("span",{staticClass:"arrows"},[n("span",{staticClass:"up",class:{active:"dateRequested"===this.currentSort&&"asc"===this.currentSortDir}},[t._v("▲")]),t._v(" "),n("span",{staticClass:"down",class:{active:"dateRequested"===this.currentSort&&"desc"===this.currentSortDir}},[t._v("▼")])])]),t._v(" "),n("th",{staticClass:"th-sort",staticStyle:{width:"10%"},on:{click:function(e){return t.sort("numPages")}}},[t._v("\n        Pages\n        "),n("span",{staticClass:"arrows"},[n("span",{staticClass:"up",class:{active:"numPages"===this.currentSort&&"asc"===this.currentSortDir}},[t._v("▲")]),t._v(" "),n("span",{staticClass:"down",class:{active:"numPages"===this.currentSort&&"desc"===this.currentSortDir}},[t._v("▼")])])]),t._v(" "),n("th",{staticStyle:{width:"15%"}},[t._v("\n        Notes\n      ")]),t._v(" "),t.statusIsPending?n("th",{staticClass:"internet-yes hide-action-col",staticStyle:{width:"19%"}},[t._v(" Action")]):n("th",{staticStyle:{width:"19%"}},[t._v("Status")])])]),t._v(" "),n("tbody",[t._l(t.sortedRequests,(function(e){return n("tr",[n("v-tooltip",{attrs:{bottom:"","content-class":"tooltip"},scopedSlots:t._u([{key:"activator",fn:function(r){var o=r.on;return[n("td",t._g({},o),[e.pdf&&!t.online?n("a",[t._v(t._s(e.title)+" ")]):t._e(),t._v(" "),e.pdf||t.online?t._e():n("span",[t._v(t._s(e.title))]),t._v(" "),t.online?n("a",{attrs:{href:t.JSTORurl(e.id),target:"_blank"}},[t._v(t._s(e.title))]):t._e()])]}}],null,!0)},[t._v(" "),n("span",[t._v(" "+t._s(t.formatCitation(e.srcHtml))+" ")])]),t._v(" "),n("td",[t._v(" "+t._s(e.studentName)+" ")]),t._v(" "),n("td",[t._v(" "+t._s(new Date(e.dateRequested).toLocaleDateString())+" |\n        "+t._s(new Date(e.dateRequested).toTimeString().substring(0,new Date(e.dateRequested).toTimeString().indexOf("GMT")).substring(0,5))+"\n      ")]),t._v(" "),n("td",[t._v(" "+t._s(e.numPages))]),t._v(" "),n("td",[t._v(" "+t._s(e.notes)+" ")]),t._v(" "),t.statusIsPending?n("td",{staticClass:"internet-yes hide-action-col"},[n("span",{staticClass:"request-buttons"},[t.online||e.pdf?n("v-btn",{attrs:{depressed:"",dark:"","x-small":"",color:"accent"},on:{click:function(n){return t.update(0,e)}}},[t._v("Print\n          ")]):t._e(),t._v(" "),t.online||e.pdf?t._e():n("v-btn",{attrs:{disabled:"",depressed:"","x-small":"",title:"This article isn't available until you get online"}},[t._v("Print\n          ")]),t._v(" "),t.online||e.pdf?n("v-btn",{attrs:{depressed:"",dark:"","x-small":"",color:"accent"},on:{click:function(n){return t.update(1,e)}}},[t._v("PDF\n          ")]):t._e(),t._v(" "),t.online||e.pdf?t._e():n("v-btn",{attrs:{disabled:"",depressed:"","x-small":"",title:"This article isn't available until you get online"}},[t._v("PDF\n          ")]),t._v(" "),n("v-btn",{attrs:{depressed:"",dark:"","x-small":"",color:"deny"},on:{click:function(n){return t.update(3,e)}}},[t._v("Deny\n          ")])],1)]):n("td",[t._v("\n        "+t._s(t.formatStatus(e.status))+"\n      ")])],1)})),t._v(" "),t.requests?t._e():n("tr",[n("br"),t._v("\n      No requests at this time\n      "),n("br"),n("br"),n("br")])],2)])],1):t._e()}),[],!1,null,"773429da",null);e.default=I.exports;F()(I,{VBtn:O.a,VCol:j.a,VFileInput:P.a,VRow:R.a,VSelect:C.a,VSimpleTable:E.a,VTooltip:T.a})}}]);